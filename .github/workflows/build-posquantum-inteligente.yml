name: ğŸ§  Build PosQuantum Desktop - INTELIGENTE AI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        
    - name: ğŸ” Debug - List Files
      run: |
        echo "=== ARQUIVOS NO DIRETÃ“RIO ==="
        dir
        echo "=== CONTEÃšDO DO main.py ==="
        type main.py
        
    - name: ğŸ§ª Test Import Inteligente
      run: |
        echo "=== TESTE INTELIGENTE DE IMPORT ==="
        python -c "
        import sys
        import os
        print(f'Python version: {sys.version}')
        print(f'Current directory: {os.getcwd()}')
        print(f'Python path: {sys.path}')
        
        # Adicionar diretÃ³rio atual ao path
        sys.path.insert(0, '.')
        
        try:
            import main
            print('âœ… main.py importado com sucesso!')
            
            # Testar execuÃ§Ã£o
            result = main.main()
            print(f'âœ… main.main() executado: {result}')
            
        except Exception as e:
            print(f'âŒ Erro no import: {e}')
            import traceback
            traceback.print_exc()
            exit(1)
        "
        
    - name: ğŸ”¨ Build ExecutÃ¡vel Inteligente
      run: |
        echo "=== BUILD PYINSTALLER INTELIGENTE ==="
        pyinstaller --onefile --name PosQuantumDesktop main.py
        
        echo "=== VERIFICANDO RESULTADO ==="
        dir dist
        
    - name: âœ… Verificar ExecutÃ¡vel
      run: |
        if (Test-Path "dist/PosQuantumDesktop.exe") {
            echo "âœ… ExecutÃ¡vel criado com sucesso!"
            $size = (Get-Item "dist/PosQuantumDesktop.exe").Length
            echo "ğŸ“Š Tamanho: $size bytes"
        } else {
            echo "âŒ ExecutÃ¡vel nÃ£o foi criado!"
            exit 1
        }
        
    - name: ğŸ“¤ Upload ExecutÃ¡vel
      uses: actions/upload-artifact@v4
      with:
        name: PosQuantumDesktop-Windows-AI
        path: dist/PosQuantumDesktop.exe
        
  build-linux:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        
    - name: ğŸ” Debug - List Files
      run: |
        echo "=== ARQUIVOS NO DIRETÃ“RIO ==="
        ls -la
        echo "=== CONTEÃšDO DO main.py ==="
        cat main.py
        
    - name: ğŸ§ª Test Import Inteligente
      run: |
        echo "=== TESTE INTELIGENTE DE IMPORT ==="
        python3 -c "
        import sys
        import os
        print(f'Python version: {sys.version}')
        print(f'Current directory: {os.getcwd()}')
        print(f'Python path: {sys.path}')
        
        # Adicionar diretÃ³rio atual ao path
        sys.path.insert(0, '.')
        
        try:
            import main
            print('âœ… main.py importado com sucesso!')
            
            # Testar execuÃ§Ã£o
            result = main.main()
            print(f'âœ… main.main() executado: {result}')
            
        except Exception as e:
            print(f'âŒ Erro no import: {e}')
            import traceback
            traceback.print_exc()
            exit(1)
        "
        
    - name: ğŸ”¨ Build ExecutÃ¡vel Inteligente
      run: |
        echo "=== BUILD PYINSTALLER INTELIGENTE ==="
        pyinstaller --onefile --name PosQuantumDesktop main.py
        
        echo "=== VERIFICANDO RESULTADO ==="
        ls -la dist/
        
    - name: âœ… Verificar ExecutÃ¡vel
      run: |
        if [ -f "dist/PosQuantumDesktop" ]; then
            echo "âœ… ExecutÃ¡vel Linux criado com sucesso!"
            ls -lh dist/PosQuantumDesktop
        else
            echo "âŒ ExecutÃ¡vel Linux nÃ£o foi criado!"
            exit 1
        fi
        
    - name: ğŸ“¤ Upload ExecutÃ¡vel Linux
      uses: actions/upload-artifact@v4
      with:
        name: PosQuantumDesktop-Linux-AI
        path: dist/PosQuantumDesktop

  create-release:
    needs: [build-windows, build-linux]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: ğŸ“¥ Download Windows Artifact
      uses: actions/download-artifact@v4
      with:
        name: PosQuantumDesktop-Windows-AI
        path: ./windows/
        
    - name: ğŸ“¥ Download Linux Artifact
      uses: actions/download-artifact@v4
      with:
        name: PosQuantumDesktop-Linux-AI
        path: ./linux/
        
    - name: ğŸ·ï¸ Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v3.0-ai-${{ github.run_number }}
        name: PosQuantum Desktop v3.0 AI Build ${{ github.run_number }}
        body: |
          ğŸ§  **Build Inteligente com IA**
          
          âœ… **ExecutÃ¡veis Gerados:**
          - ğŸªŸ Windows: PosQuantumDesktop.exe
          - ğŸ§ Linux: PosQuantumDesktop
          
          ğŸ¯ **Funcionalidades:**
          - Sistema ultra otimizado
          - Import inteligente
          - Debug completo
          
          ğŸ“Š **Status:** Build 100% funcional
        files: |
          windows/PosQuantumDesktop.exe
          linux/PosQuantumDesktop
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  build-summary:
    needs: [build-windows, build-linux, create-release]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - name: ğŸ“Š Build Summary
      run: |
        echo "ğŸ§  === RESUMO DO BUILD INTELIGENTE ==="
        echo "âœ… Windows Build: ${{ needs.build-windows.result }}"
        echo "âœ… Linux Build: ${{ needs.build-linux.result }}"
        echo "âœ… Release: ${{ needs.create-release.result }}"
        echo "ğŸ¯ Build AI concluÃ­do com sucesso!"

